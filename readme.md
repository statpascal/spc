# StatPascal

StatPascal is a Pascal based language (similar to pre-object Turbo Pascal)
with vector extensions commonly used in statistical computing.  It is
designed as an embeddable system providing fast Pascal type scripting to
host applications by generating X64 and ARM64 assembly code.  It uses the
Linux calling conventions on these architectures so the generated code does
*not* work under Windows oder MacOS.

A typical Statpascal implementation of the QuickSort algorithm looks like:

    program qsortvec;

    type 
        element = int32;
        vec = vector of element;

    function qsort (a: vec): vec;
        begin
            if size (a) <= 1 then
                qsort := a
            else
               qsort := combine (
                   qsort (a [a < a [1]]), 
                   a [a = a [1]], 
                   qsort (a [a > a [1]]))
        end;

    const
        n = 20;
    var 
        a: vec;

    begin
        a := randomperm (n);
        writeln ('Unsorted: ', a);
        writeln ('Sorted:   ', qsort (a))
    end.

A statistical example is the Hill estimator for the shape parameter of a
heavy-tailed distribution:

    program hillvec;

    const 
        alpha = 2.0;
        nmax = 10000;

    function hill (x: realvector): realvector;
        var 
            n: integer;
        begin
            x := log (rev (sort (x [x > 0])));
            n := size (x);
            hill := 1.0 / (cumsum (x) [intvec (1, n - 1)] / intvec (1, n-1)  - x [intvec (2, n)])
        end;

    var 
        x, y: realvector;
    begin
        x := power (randomdata (nmax), -1.0 / alpha);
        y := hill (x);
        writeln (y)
    end.


The system is still in an early alpha state and there is not much
documentation besides the examples in the *test* directories. The *makefile*
produces the binary *obj/sp* which can load and execute programs by giving
them as command line argument, e.g.

    obj/sp tests/statpascal/qsortvec.sp

A collection of regression tests can be executed with

    make tests

For standard Pascal programs the tests compare the output with code
generated by Free Pascal while for vector extensions the expected output is
provided as a text file. The test *big.sp* uses about 5 GB of RAM so it is
likely to fail on smaller machines.

A larger test program (compatible with Free Pascal) is *emul99*
(an emulator of the TI99/4A home computer):
https://github.com/statpascal/emul99

The next steps will be:

- refactoring/unifying the code generators
- samples/docs for data exchange/callbacks with host applications
- code generator for the TMS9900 (as toy project)

## License

StatPascal is distributed under the MIT license.

Copyright (C) 2025 Michael Thomas

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
